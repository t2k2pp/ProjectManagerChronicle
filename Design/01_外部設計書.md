# PM立志伝：プロジェクト・クロニクル 外部設計書

**Version**: 2.0  
**Last Updated**: 2025-12-30  
**Document Type**: External Design Specification

> **v2.0 変更点**: 太閤立志伝要素（複数企業、800人NPC、時代システム、キャリアパス）を統合

---

## 1. システム概要

### 1.1 プロダクト名
**PM立志伝：プロジェクト・クロニクル（Project Manager Chronicle）**

### 1.2 プロダクトの目的
プロジェクトマネジメント（PM）の実践的な知識と判断力を、ゲーミフィケーションを通じて習得できるシミュレーション型学習アプリケーション。

### 1.3 ターゲットユーザー
- 現役の若手・中堅プロジェクトマネージャー
- PMを目指すエンジニア・ビジネスパーソン
- 経営シミュレーションゲームファン
- 企業研修・教育機関（BtoB展開）

### 1.4 コアバリュー
1. **理論と実践の融合**: PMBOK準拠の正しい知識が成功の鍵
2. **運要素の排除**: ランダム性ではなく、論理的判断で結果が決まる
3. **AI活用学習**: プレイ後に生成AIが詳細な振り返りレポートを提供
4. **人間ドラマの再現**: NPCの個性と関係性がプロジェクトに影響
5. **壮大なスケール**: 800人以上のNPC、20社以上の企業、40年の時代変遷
6. **立志伝的成長**: 一社員から社長へ、日本一のIT企業を目指すキャリアパス

---

## 2. システムアーキテクチャ

### 2.1 アーキテクチャ方針
**Local-First Architecture（ローカルファースト設計）**

全てのゲームロジック、状態管理、データ永続化はクライアント側で完結。サーバーはAI分析機能のみを提供するステートレス構成。

### 2.2 技術スタック

#### フロントエンド
- **フレームワーク**: React 18+ (Vite)
- **言語**: TypeScript 5+
- **状態管理**: Zustand または React Context + useReducer
- **UIライブラリ**: Tailwind CSS 3+
- **アニメーション**: Framer Motion
- **グラフ描画**: Recharts / Chart.js
- **ドラッグ&ドロップ**: dnd-kit

#### データ永続化
- **主データベース**: IndexedDB (Dexie.js wrapper)
- **設定情報**: localStorage
- **データ形式**: JSON

#### バックエンド（オプショナル）
- **AI Proxy**: FastAPI (Python)
- **LLM**: Gemini API / OpenAI API / ローカルLLM (Ollama)
- **通信**: REST API（ゲーム完了時のみ）

### 2.3 デプロイメント
- **形態**: PWA (Progressive Web App)
- **ホスティング**: GitHub Pages / Netlify / Vercel
- **オフライン対応**: Service Worker によるフルオフライン動作

---

## 3. 機能要件

### 3.1 コア機能

#### 3.1.1 ゲーム開始設定
**機能ID**: `F-001`

- **開始年選択**
  - 1990年 / 1995年 / 2000年 / 2005年 / 2010年 / 2015年 / 2020年 / 2025年
  - 各時代でIT業界トレンド、必要スキルが異なる

- **開始タイプ選択**
  - 新卒入社（22歳、低能力、高成長余地）
  - 中途入社（28-40歳、中能力、即戦力）
  - フリーランス（25-45歳、中-高能力、案件獲得必要）

- **キャラクター選択**
  - 既存NPC選択（推奨NPCリストから選択、バックストーリー付き）
  - 新規作成（名前入力、PM適性診断で能力決定）

- **難易度選択**
  - 研修生（Easy）: ヒント機能付き、上司による救済あり
  - プロジェクトリーダー（Normal）: 標準的なQCD制約
  - デスマーチ請負人（Hard）: 炎上中プロジェクトの引き継ぎ

- **就職先選択**（新卒・中途の場合）
  - 応募 → 面接イベント → 内定/不採用
  - 企業一覧から選択可能

**出力**: 初期ワールドデータ生成（企業20社以上、NPC800人以上、案件パイプライン）

#### 3.1.2 プロジェクト管理サイクル
**機能ID**: `F-002`

**4フェーズ管理**:
1. **立ち上げ（Initiating）**
   - 案件選択（既存顧客/新規顧客、一般企業/公的機関）
   - 入札バトル（RFP読解、見積もり、プレゼン対決）
   - プロジェクト憲章作成

2. **計画（Planning）**
   - チーム編成（ドラッグ&ドロップ）
   - WBS作成（パズル形式）
   - クリティカルパス特定
   - リスク登録簿作成

3. **実行・監視（Executing & Monitoring）**
   - 週次ターン進行（月曜Plan → 火-木Execute → 金曜Review）
   - デイリースクラム
   - トラブルシューティング
   - ステークホルダー交渉

4. **終結（Closing）**
   - 検収・リリース
   - QCDスコア算出
   - KPT振り返り
   - AI学習レポート生成

#### 3.1.3 カレンダーシステム
**機能ID**: `F-003`

- **年度制**: 4月始まり（日本会計年度準拠）
- **季節イベント**:
  - GW（4-5月）
  - お盆（8月）
  - 年末年始（12-1月）
- **休暇調整パズル**: 長期休暇2週間前に発生
- **時間経過**: 1ターン = 1週間（月-金）

#### 3.1.4 交渉カードバトル
**機能ID**: `F-004`

**対象**: 顧客、上司、開発メンバーとの利害対立

**カード種類**:
- **防御**: スコープ・クリープ（契約外拒否）
- **調整**: トレードオフ提案
- **攻撃**: エスカレーション（上司召喚）
- **回復**: 心理的安全性確保
- **特殊**: 直談判（自由記述）

**勝利条件**: 相手の「納得ゲージ」を満タンにする、または「不満ゲージ」をゼロにする

#### 3.1.5 AI振り返りレポート
**機能ID**: `F-005`

**生成タイミング**: プロジェクト完了時

**レポート構成**:
1. **PMスタイル分析**: 行動傾向の客観評価
2. **重要局面の評価**: 岐路となった判断の解説
3. **用語解説**: 使用したPM用語の定義
4. **KPT分析**: Keep / Problem / Try の提示
5. **スキル成長提案**: 次に学ぶべき領域

### 3.2 サブ機能

#### 3.2.1 キャラクター管理
**機能ID**: `F-101`

- 社員名簿の閲覧
- ダブル・ヘキサゴン（12パラメータ）表示
- 信頼度管理
- 二つ名開眼システム
- トレーニング（スキル育成）

#### 3.2.2 市場・競合分析
**機能ID**: `F-102`

- 市場レポート閲覧
- 競合他社動向
- BP（ビジネスパートナー）空き状況確認
- 案件パイプライン表示

#### 3.2.3 データ管理
**機能ID**: `F-103`

- セーブデータのエクスポート（JSON）
- セーブデータのインポート
- マルチセーブ対応（最大5スロット）
- オートセーブ（週次自動保存）

### 3.3 太閤立志伝要素機能

#### 3.3.1 企業システム
**機能ID**: `F-201`

- **企業群管理**
  - 大企業5社 + 中小企業15社 + ベンチャー5社（後発）
  - 企業名はプレフィックス+中央語+サフィックスで自動生成
  - 各企業の規模、特性、得意分野、評判を管理

- **企業の興亡**
  - 時代イベントに応じた新興企業の誕生
  - 財務悪化による破産（プレイヤー所属企業は活躍で回避可能）
  - M&A（吸収合併）イベント

- **企業ランキング**
  - 年商、評判、シェアによる業界順位表示
  - 勝利条件への進捗表示

#### 3.3.2 NPC人材システム
**機能ID**: `F-202`

- **800人以上の固有NPC**
  - 名前、能力、性格、バックストーリー
  - 各企業への配属状態管理
  - フリーランス（在野）NPCの管理

- **モブ社員**
  - 名前のないその他xxx人として表現
  - プロジェクト人員の補完

- **NPC行動シミュレーション**
  - 転職、退職、定年、フリーランス化
  - 結婚、出産、介護離職
  - ヘッドハンティング、引き抜き

#### 3.3.3 時代・歴史イベントシステム
**機能ID**: `F-203`

- **時代区分**（1990-2030年）
  - 汎用機・C/S時代（1990-1999）
  - Web時代（2000-2009）
  - モバイル・クラウド時代（2010-2019）
  - AI・DX時代（2020-2030）

- **歴史イベント**
  - ITバブル崩壊（2000年）
  - 世界金融危機（2008年）
  - 東日本大震災（2011年）
  - 世界疫病危機（2020年）

- **スキルトレンド**
  - 時代ごとの需要スキル変化
  - 陳腐化スキルのペナルティ

#### 3.3.4 キャリアパスシステム
**機能ID**: `F-204`

- **昇進システム**
  - 新人 → 一般 → 主任 → リーダー → 課長 → 部長 → 本部長 → 取締役 → 社長

- **転職・独立**
  - 他社への転職活動
  - フリーランスへの転向
  - 起業（社長就任）

- **勝利条件**
  - ルートA: 所属企業を日本一にする
  - ルートB: 自分が社長として日本一にする

#### 3.3.5 日常活動システム
**機能ID**: `F-205`

- **社内活動**
  - 社内研修、勉強会開催
  - 飲み会企画（士気回復）
  - 社内清掃（出会いイベント）
  - メンター活動

- **社外活動**
  - 展示会出展
  - カンファレンス参加
  - 技術ブログ執筆
  - OSS活動

- **人間関係**
  - 恋愛・結婚システム
  - ライバル関係
  - 人脈形成

---

## 4. 画面設計

### 4.1 画面遷移図

```
[タイトル画面]
    ↓
[ゲーム設定]
    ↓
[社長室（ダッシュボード）]
    ├─→ [案件選択]
    │       ↓
    │   [入札バトル]
    │       ↓
    ├─→ [PMコックピット] ← メイン画面
    │       ├─→ [キャラ詳細]
    │       ├─→ [交渉カードバトル]
    │       └─→ [休暇調整パズル]
    │
    ├─→ [社員名簿]
    ├─→ [市場調査]
    └─→ [設定・データ管理]
```

### 4.2 主要画面仕様

#### 4.2.1 PMコックピット（メイン画面）
**画面ID**: `S-001`

**レイアウト構成**:

```
+------------------------------------------------------------------+
|  [Header - HUD]                                                   |
|  カレンダー | EVMメーター（SPI/CPI） | 残予算 | 進捗率           |
+------------------------------------------------------------------+
|                    |                                              |
|  [Office View]     |        [Gantt Chart View]                    |
|   座席表           |         WBS進捗管理                           |
|   キャラカード表示  |         ドラッグ&ドロップ                     |
|   体力ゲージ       |         クリティカルパス表示                  |
|   状態アイコン     |         リスク予兆アイコン                    |
|                    |                                              |
+------------------------------------------------------------------+
|  [Command Deck]                                                   |
|  [EXECUTE] [EXPORT] [IMPORT] [SETTINGS]                          |
+------------------------------------------------------------------+
```

**インタラクション**:
- キャラカードクリック → 詳細ステータスモーダル
- ガントチャートのタスクバーへドラッグ → アサイン変更
- EXECUTEボタン → 1週間分のシミュレーション実行

#### 4.2.2 交渉カードバトル画面
**画面ID**: `S-002`

**表示要素**:
- 左: プレイヤー（PM）
- 右: 対戦相手（顧客/上司/メンバー）
- 中央: ゲージ（納得/不満）
- 下部: 手札（カード5枚）
- ログエリア: 行動履歴

**特殊カード「直談判」発動時**:
1. 時間停止
2. テキストボックス表示
3. お題提示（例: "納期短縮を拒否する理由を述べよ"）
4. プレイヤー入力（200文字まで）
5. AI判定（3秒以内）
6. 結果演出（Good/Bad）

#### 4.2.3 休暇調整パズル画面
**画面ID**: `S-003`

**表示要素**:
- カレンダーグリッド（14日間）
- メンバーごとの希望休ブロック
- 稼働必須日のハイライト

**パズルルール**:
- 稼働必須日に誰も配置できないとゲームオーバー
- 交渉可能キャラには🔓、不可には🔒アイコン
- 交渉成功で予算またはAP消費

---

## 5. データモデル概要

### 5.1 主要エンティティ

#### 5.1.1 Character（NPC人材）
```typescript
{
  id: string;              // UUID
  name: string;
  birthYear: number;       // 生年（年齢計算用）
  gender: 'M' | 'F' | 'OTHER';
  
  // 所属（太閤要素）
  status: 'EMPLOYED' | 'FREELANCE' | 'RETIRED' | 'DECEASED';
  companyId?: string;      // 所属企業ID（フリーランスはnull）
  position: {              // 役職
    title: 'NEWCOMER' | 'MEMBER' | 'SENIOR' | 'LEADER' | 'MANAGER' | 
           'SENIOR_MANAGER' | 'DIRECTOR' | 'EXECUTIVE' | 'VICE_PRESIDENT' | 'PRESIDENT';
    rank: number;          // 1-10
  };
  joinYear: number;        // 入社年
  
  // 能力（ダブルヘキサゴン）
  statsBlue: {             // 表スキル
    design: number;        // 0-10
    develop: number;
    test: number;
    negotiation: number;
    propose: number;
    judgment: number;
  };
  statsRed: {              // 裏スキル
    admin: number;
    organizer: number;
    service: number;
    chat: number;
    charm: number;
    luck: number;
  };
  
  // 状態
  stamina: {
    current: number;
    max: number;
    recoveryRate: number;
  };
  traits: string[];        // ["vacation_lover", "night_owl"]
  techSkills: string[];    // ["Java", "Python", "AWS"] 時代で陳腐化
  
  // 関係性（太閤要素）
  loyalty: number;         // 会社への忠誠度（0-100）
  ambition: number;        // 野心（0-100）
  relationships: {         // 他NPCとの関係
    npcId: string;
    type: 'COLLEAGUE' | 'RIVAL' | 'MENTOR' | 'MENTEE' | 'FRIEND' | 'SPOUSE';
    strength: number;      // 0-100
  }[];
  
  // プライベート（太閤要素）
  marriageStatus: 'SINGLE' | 'MARRIED' | 'DIVORCED';
  spouseId?: string;       // 配偶者NPC ID
  childCount: number;
  
  // 隠しデータ
  hiddenData?: {           // 覚醒前はマスク
    trueName: string;
    trueStats: object;
    backstory: string;
  };
}
```


#### 5.1.2 Project（プロジェクト）
```typescript
{
  id: string;
  name: string;
  client: string;
  budget: {
    initial: number;
    current: number;
  };
  schedule: {
    startWeek: number;
    endWeek: number;
    currentWeek: number;
  };
  evm: {
    pv: number;            // 計画値
    ev: number;            // 出来高
    ac: number;            // 実コスト
    spi: number;           // スケジュール効率指数
    cpi: number;           // コスト効率指数
  };
  status: 'PLANNING' | 'RUNNING' | 'COMPLETED' | 'FAILED';
}
```

#### 5.1.3 Task（タスク）
```typescript
{
  id: string;
  projectId: string;
  assigneeId: string | null;
  phase: 'REQUIREMENT' | 'DESIGN' | 'DEVELOP' | 'TEST';
  progress: number;        // 0-100
  quality: number;         // 品質スコア
  riskFactor: number;      // 潜在リスク値
  dependencies: string[];  // 先行タスクID
}
```

#### 5.1.4 WeeklyLog（週次ログ）
```typescript
{
  week: number;
  eventType: 'PROGRESS' | 'TROUBLE' | 'DECISION' | 'NEGOTIATION';
  description: string;
  pmComment?: string;      // プレイヤーの自由記述
  cardsUsed?: string[];    // 使用したカード名
}
```

#### 5.1.5 Company（企業）【太閤要素】
```typescript
{
  id: string;              // UUID
  name: string;            // 自動生成された企業名
  foundedYear: number;     // 設立年
  category: 'LARGE' | 'MEDIUM' | 'VENTURE';
  
  // 規模
  employeeCount: number;   // 名前付きNPC数
  mobEmployeeCount: number; // モブ社員数
  revenue: number;         // 年商（億円）
  
  // 特性
  culture: {
    workStyle: 'TRADITIONAL' | 'BALANCED' | 'FLEXIBLE';
    hierarchy: 'STRICT' | 'MODERATE' | 'FLAT';
    innovation: 'CONSERVATIVE' | 'MODERATE' | 'AGGRESSIVE';
    training: 'MINIMAL' | 'STANDARD' | 'EXTENSIVE';
  };
  specialties: string[];   // 得意分野
  
  // 状態
  reputation: number;      // 業界評判（0-100）
  financialHealth: number; // 財務健全性（0-100）
  growthRate: number;      // 成長率
  
  // 関係
  rivals: string[];        // ライバル企業ID
  partners: string[];      // 協業企業ID
  
  // 歴史
  isActive: boolean;       // 存続中か
  bankruptYear?: number;   // 破産年
  acquiredBy?: string;     // 買収された企業ID
}
```

#### 5.1.6 WorldState（世界状態）【太閤要素拡張】
```typescript
{
  seed: number;            // 再現用シード値
  startYear: number;       // 開始年（1990-2025）
  currentYear: number;     // 現在年
  currentWeek: number;     // 現在週
  
  // 企業群
  companies: Company[];
  
  // NPC群
  npcs: Character[];
  freelancers: Character[];
  retiredNpcs: Character[];
  
  // 業界状態
  industryState: {
    totalMarketSize: number;    // 市場規模（兆円）
    trendingSkills: string[];   // トレンドスキル
    decliningSkills: string[];  // 陳腐化スキル
  };
  
  // 歴史
  pastEvents: HistoricalEvent[];
}
```

### 5.2 IndexedDB ストア構成

**データベース名**: `pm_chronicle_db`  
**バージョン**: 2

**ストア一覧**:
1. `saves` - セーブデータ（最大5件）
2. `characters` - 800人以上のNPCデータ
3. `companies` - 企業データ【追加】
4. `projects` - プロジェクトデータ
5. `tasks` - タスクデータ
6. `logs` - プレイログ
7. `world_state` - 世界環境データ
8. `historical_events` - 歴史イベントデータ【追加】

---

## 6. 非機能要件

### 6.1 パフォーマンス
- 初回ロード時間: 3秒以内
- ターン計算処理: 500ms以内
- UI操作レスポンス: 100ms以内

### 6.2 ユーザビリティ
- デスクトップブラウザ最適化（1920x1080推奨）
- 日本語UI（将来的に英語対応）
- アクセシビリティ: WCAG 2.1 AA準拠

### 6.3 ブラウザ対応
- Chrome 90+
- Edge 90+
- Firefox 88+
- Safari 14+（iOS含む）

### 6.4 データ保全
- 週次オートセーブ
- JSON形式エクスポート機能
- バックアップ推奨通知（プロジェクト開始時）

### 6.5 セキュリティ
- チート対策は実施しない（学習用のため）
- ローカルストレージのみ使用（個人情報不要）
- AI通信時のログ匿名化

---

## 7. 外部インターフェース

### 7.1 AI分析API

**エンドポイント**: `POST /api/v1/analyze`

**リクエスト**:
```json
{
  "version": "1.0",
  "project_id": "uuid",
  "final_score": {
    "quality": 85,
    "cost": 95,
    "delivery": 90
  },
  "logs": [
    {
      "week": 1,
      "eventType": "DECISION",
      "description": "...",
      "cardsUsed": ["scope_creep"]
    }
  ]
}
```

**レスポンス**:
```json
{
  "report": "# あなたのPMスタイル\n...",
  "vocabulary": ["WBS", "クリティカルパス"],
  "recommendations": ["3点見積もり法を学習"]
}
```

### 7.2 データエクスポート形式

**ファイル名**: `pm_save_YYYYMMDD_HHMMSS.json`

**構造**:
```json
{
  "version": "1.0",
  "exported_at": "2025-12-30T14:00:00Z",
  "save_data": {
    "company_info": {...},
    "characters": [...],
    "current_project": {...},
    "tasks": [...],
    "logs": [...]
  },
  "checksum": "sha256_hash"
}
```

---

## 8. 制約事項

### 8.1 技術的制約
- ブラウザのIndexedDB容量制限（通常50MB程度）
- ローカルLLM使用時はユーザーPC性能に依存
- Service Workerの更新タイミングによるキャッシュ問題

### 8.2 ビジネス的制約
- 初期バージョンはソロプレイのみ（マルチプレイなし）
- AI機能は外部APIに依存（コスト発生）
- 実在企業名・人名の使用制限

### 8.3 法的制約
- PMBOK®は登録商標（明示的な引用時は®表記）
- ゲームバランスの過度な調整による教育効果の低下回避

---

## 9. 今後の拡張可能性

### 9.1 フェーズ2候補機能
- アジャイル開発モード（スクラム/カンバン）
- グローバルランキング
- カスタムシナリオエディタ
- モバイルアプリ化（React Native移植）

### 9.2 BtoB展開
- 企業研修パッケージ
- 学習履歴の可視化ダッシュボード
- チーム対戦モード

---

## 10. 用語集

| 用語 | 説明 |
|------|------|
| **PMBOK** | Project Management Body of Knowledge - プロジェクトマネジメント知識体系 |
| **QCD** | Quality, Cost, Delivery - 品質、コスト、納期 |
| **EVM** | Earned Value Management - 出来高管理 |
| **SPI** | Schedule Performance Index - スケジュール効率指数（1.0が基準） |
| **CPI** | Cost Performance Index - コスト効率指数（1.0が基準） |
| **WBS** | Work Breakdown Structure - 作業分解構成図 |
| **クリティカルパス** | 最長所要時間経路。ここに遅延が出るとプロジェクト全体が遅れる |
| **スコープ・クリープ** | 仕様の無秩序な拡大 |

---

**承認履歴**:

| 日付 | バージョン | 承認者 | 備考 |
|------|-----------|--------|------|
| 2025-12-30 | 1.0 | - | 初版作成 |

---

**Document End**
