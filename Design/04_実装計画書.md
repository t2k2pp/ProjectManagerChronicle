# PM立志伝：プロジェクト・クロニクル 実装計画書

**Version**: 2.0  
**作成日**: 2025-12-30  
**プロジェクトURL**: https://github.com/t2k2pp/ProjectManagerChronicle

> **v2.0 変更点**: 太閤立志伝要素（企業システム、800人NPC、時代イベント）フェーズを追加

---

## 📊 プロジェクト概要

**目的**: プロジェクトマネジメント（PM）の実践的な知識と判断力を、ゲーミフィケーションを通じて習得できるシミュレーション型学習アプリケーション

**技術スタック**:
- Frontend: React 18 + Vite + TypeScript
- State: Zustand
- Database: IndexedDB (Dexie.js)
- UI: Tailwind CSS + Framer Motion
- Charts: Recharts
- DnD: @dnd-kit

---

## 📁 既存の成果物

### ✅ 完成済み

- **外部設計書** (`Design/01_外部設計書.md`) - v2.0に更新
- **詳細設計書** (`Design/02_詳細設計書.md`)
- **UI設計書** (`Design/03_UI設計書.md`)
- **太閤立志伝要素追加設計書** (`Design/06_太閤立志伝要素追加設計書.md`) - 新規
- **HTMLモックアップ** (`Design/mockups/*.html`) - 5画面
- **コンセプトドキュメント** (12ファイル)

---

## 🎯 実装フェーズ計画

### Phase 0: プロジェクトセットアップ ⏱️ 1日

**Goal**: 開発環境の構築とディレクトリ構造の作成

#### タスク一覧
- [x] Vite + React + TypeScript プロジェクト作成
- [x] 依存関係のインストール
  ```bash
  npm install dexie zustand framer-motion recharts
  npm install @dnd-kit/core @dnd-kit/sortable
  npm install tailwindcss postcss autoprefixer
  ```
- [x] Tailwind CSS 設定
- [x] ディレクトリ構造作成（詳細設計書に準拠）
- [ ] ESLint/Prettier 設定
- [x] Git設定（.gitignore追加）

#### 成果物
- `pm-chronicle/` プロジェクトフォルダ
- 動作する空のReactアプリ

---

### Phase 1: データ基盤構築 ⏱️ 3-4日

**Goal**: IndexedDBスキーマとリポジトリパターンの実装

#### タスク一覧
- [x] **Day 1**: Dexie.js スキーマ定義
  - [x] `src/db/schema.ts` - 全エンティティ型定義
  - [x] SaveSlot, WorldState, Character, Project, Task, WeeklyLog
  - [ ] マイグレーション設定

- [x] **Day 2**: リポジトリ実装
  - [x] `src/db/repositories/characterRepository.ts`
  - [x] `src/db/repositories/projectRepository.ts`
  - [x] `src/db/repositories/logRepository.ts`
  - [ ] CRUD操作のテスト

- [x] **Day 3**: ワールド生成ロジック
  - [x] `src/lib/generators/companyGenerator.ts`
  - [x] `src/lib/generators/characterGenerator.ts`
  - [x] 初期データ生成とシード値

- [x] **Day 4**: テストデータ作成
  - [x] 固有NPC 800人以上のマスターデータ生成【太閤要素】
  - [x] 企業20社の初期データ生成【太閤要素】
  - [ ] 初期プロジェクトテンプレート
  - [ ] 動作確認スクリプト

#### 成果物
- IndexedDB 動作確認完了
- 800人NPC、20社企業が正常に保存・読み込みできる

---

### Phase 1.5: 太閤立志伝要素基盤 ⏱️ 5-7日【新規】

**Goal**: 企業システム、NPC人材システム、時代イベントの実装

#### タスク一覧
- [x] **Day 1-2**: 企業生成システム
  - [x] `src/lib/generators/companyGenerator.ts`
  - [x] 企業名生成（プレフィックス+中央+サフィックス）
  - [x] 企業属性（規模、特性、得意分野）ランダム生成

- [x] **Day 3-4**: NPC生成システム
  - [x] `src/lib/generators/characterGenerator.ts`
  - [x] 日本人名生成（姓150種+名80種）
  - [x] 800人NPC生成（能力値、性格、所属企業）
  - [ ] 初期関係性生成（同期、上司部下）

- [x] **Day 5**: 時代・歴史イベントシステム
  - [x] `src/lib/events/historicalEvents.ts`
  - [x] 時代区分定義（1990-2030年）
  - [x] 歴史イベント（16イベント定義）
  - [x] スキルトレンド変化ロジック

- [x] **Day 6-7**: NPC行動シミュレーション
  - [x] `src/lib/simulation/npcSimulator.ts`
  - [x] 転職、退職、定年ロジック
  - [x] 企業興亡（破産）ロジック

#### 成果物
- 40年間シミュレーション（企業興亡、NPC動態）が動作

---

### Phase 2: 状態管理とゲームエンジン ⏱️ 5-6日

**Goal**: Zustand ストアとコアゲームロジックの実装

#### タスク一覧
- [x] **Day 1-2**: Zustand ストア構築
  - [x] `src/store/gameStore.ts` - メインストア
  - [ ] `src/store/slices/worldSlice.ts`
  - [ ] `src/store/slices/projectSlice.ts`
  - [ ] `src/store/slices/characterSlice.ts`
  - [ ] `src/store/slices/uiSlice.ts`
  - [ ] セレクター定義

- [x] **Day 3-4**: ターン処理エンジン
  - [x] `src/lib/engine/turnProcessor.ts`
  - [x] 週次ターン処理ループ
  - [x] 日次シミュレーション
  - [x] イベント生成・判定

- [x] **Day 5**: EVM計算ロジック
  - [x] `src/lib/calculators/evmCalculator.ts`
  - [x] PV/EV/AC/SPI/CPI 算出
  - [ ] グラフ用データ生成

- [ ] **Day 6**: 進捗・品質・スタミナ計算
  - [ ] `src/lib/calculators/progressCalculator.ts`
  - [ ] `src/lib/calculators/qualityCalculator.ts`
  - [ ] `src/lib/calculators/staminaCalculator.ts`

#### 成果物
- Zustand ストアで全状態管理可能
- ターン処理が正しく動作（コンソールログで確認）

---

### Phase 3: UIコンポーネント実装 ⏱️ 7-8日

**Goal**: 再利用可能なUIコンポーネントライブラリの構築

#### タスク一覧
- [x] **Day 1-2**: 共通コンポーネント
  - [x] `src/components/common/Button.tsx`
  - [x] `src/components/common/Card.tsx`
  - [ ] `src/components/common/Modal.tsx`
  - [x] `src/components/common/Badge.tsx`
  - [ ] Storybook セットアップ（オプション）

- [x] **Day 3**: ヘキサゴンチャート
  - [x] `src/components/common/HexagonChart.tsx`
  - [x] SVG実装（HTMLモックアップ移植）
  - [x] プロップス設計（blue/red/both モード）

- [x] **Day 4**: ガントチャート
  - [x] `src/components/game/PMCockpit/GanttChart.tsx`
  - [x] SVG実装
  - [x] タスクバー、進捗表示

- [x] **Day 5**: EVMメーター
  - [x] `src/components/game/PMCockpit/EVMeter.tsx`
  - [x] 針式ゲージ（SVG）
  - [x] 色分け（緑/黄/赤）

- [x] **Day 6**: キャラクターカード
  - [x] `src/components/game/PMCockpit/CharacterCard.tsx`
  - [x] スタミナゲージ
  - [x] 状態アイコン（emoji）

- [x] **Day 7-8**: ドラッグ&ドロップ
  - [x] @dnd-kit 統合
  - [x] `src/components/game/PMCockpit/TaskAssignment.tsx`
  - [x] ドロップ時の検証ロジック

#### 成果物
- 全UIコンポーネントがStorybook（または個別ページ）で確認可能
- ドラッグ&ドロップ動作確認

---

### Phase 4: メイン画面実装 ⏱️ 8-10日 ✅

**Goal**: PMコックピット（中核画面）の完成

#### タスク一覧
- [x] **Day 1-2**: レイアウト構築
  - [x] `src/components/screens/PMCockpitScreen.tsx`
  - [x] HUD（ヘッダー）
  - [x] 2カラムレイアウト（オフィス + ガント）
  - [x] コントロールパネル（フッター）

- [x] **Day 3-4**: オフィスビュー
  - [x] `src/components/game/PMCockpit/OfficeView.tsx`
  - [x] キャラカードグリッド表示
  - [x] Zustand からキャラクターデータ取得
  - [x] リアルタイム更新

- [x] **Day 5-6**: ガントチャート統合
  - [x] タスク一覧表示
  - [x] 進捗バー
  - [x] クリティカルパス表示
  - [ ] リスク予兆アイコン（後日対応）

- [x] **Day 7**: アサイン機能
  - [x] ドラッグ&ドロップでアサイン変更
  - [x] バリデーション（稼働可能か確認）
  - [x] Zustand ストア更新

- [x] **Day 8**: ターン進行ボタン
  - [x] 「1週間進める」ボタン実装
  - [x] `src/components/game/PMCockpit/TurnControlPanel.tsx`
  - [x] プログレスバー表示
  - [ ] TurnProcessor統合（後日対応）

- [x] **Day 9-10**: 週間方針・詳細調整
  - [x] 週間方針選択（Normal/Quality/Rush）
  - [ ] ツールチップ、ヘルプ表示（後日対応）
  - [ ] アニメーション調整（後日対応）

#### 成果物
- **PMコックピット完全動作**
- ターンを進めてプロジェクトが進捗する

---

### Phase 5: ダッシュボード・ナビゲーション ⏱️ 3-4日 ✅

**Goal**: 社長室とゲーム全体のナビゲーション

#### タスク一覧
- [x] **Day 1-2**: ダッシュボード画面
  - [x] `src/components/screens/DashboardScreen.tsx`
  - [x] HTMLモックアップ移植
  - [x] カード型レイアウト
  - [x] Zustand から組織状態取得

- [x] **Day 3**: ルーティング
  - [x] App.tsxでの画面遷移実装
  - [x] 画面遷移（Dashboard ↔ PMCockpit）
  - [x] 戻るボタン

- [x] **Day 4**: キャラクター詳細モーダル
  - [x] `src/components/game/CharacterSheet/StatusDisplay.tsx`
  - [x] ダブル・ヘキサゴン統合
  - [x] `src/components/game/CharacterSheet/CharacterModal.tsx`

#### 成果物
- ダッシュボードからPMコックピットへ遷移可能
- キャラクター詳細モーダル動作

---

### Phase 6: カードバトル ⏱️ 5-6日 ✅

**Goal**: 交渉カードバトルシステムの実装

#### タスク一覧
- [x] **Day 1-2**: バトルフィールド
  - [x] `src/components/game/CardBattle/BattleField.tsx`
  - [x] プレイヤー vs 対戦相手レイアウト
  - [x] ゲージ表示
  - [x] ターン制バトルシステム

- [x] **Day 3**: カードシステム
  - [x] `src/components/game/CardBattle/CardComponent.tsx`
  - [x] `src/components/game/CardBattle/cardData.ts`
  - [x] カード使用ロジック
  - [x] コスト管理

- [ ] **Day 4**: 直談判（AI判定）
  - [ ] `src/components/game/CardBattle/DirectNegotiation.tsx`（後日対応）
  - [ ] テキスト入力ダイアログ
  - [ ] AI判定モック（ローカル評価）

- [x] **Day 5**: バトルロジック
  - [x] ゲージ増減計算
  - [x] 勝敗判定
  - [x] ログ記録

- [ ] **Day 6**: 統合・調整
  - [ ] カードエフェクトアニメーション（後日対応）
  - [ ] サウンド（オプション）

#### 成果物
- **カードバトル基本動作**
- AI判定なしでもプレイ可能

---

### Phase 7: セーブ/ロード・データ管理 ⏱️ 2-3日 ✅

**Goal**: データ永続化とインポート/エクスポート

#### タスク一覧
- [x] **Day 1**: セーブ/ロード機能
  - [x] `src/services/saveService.ts`
  - [x] 現在の状態をIndexedDBに保存
  - [x] セーブスロット管理（最大5件）
  - [x] オートセーブ機能

- [x] **Day 2**: エクスポート/インポート
  - [x] `src/services/exportService.ts`
  - [x] JSON形式でエクスポート
  - [x] チェックサム生成
  - [x] ファイルダウンロード

- [x] **Day 3**: インポート・バリデーション
  - [x] `src/services/importService.ts`
  - [x] JSONファイル読み込み
  - [x] バリデーション
  - [x] データ復元

#### 成果物
- セーブ/ロード動作確認
- JSON エクスポート/インポート成功

---

### Phase 8: 追加画面・機能 ⏱️ 5-7日

**Goal**: 休暇パズル、社員名簿、ゲーム設定など

#### タスク一覧
- [ ] **Day 1-2**: 休暇調整パズル
  - [ ] `src/components/game/VacationPuzzle/CalendarGrid.tsx`
  - [ ] パズルエンジン
  - [ ] 交渉ダイアログ
  - [ ] 解答検証

- [ ] **Day 3**: 社員名簿画面
  - [ ] `src/components/screens/CharacterList.tsx`
  - [ ] 一覧表示
  - [ ] 検索・フィルタ
  - [ ] ソート機能

- [ ] **Day 4**: ゲーム設定画面
  - [ ] `src/components/screens/GameSetup.tsx`
  - [ ] ウィザード形式
  - [ ] 難易度・会社規模選択
  - [ ] ワールド生成

- [ ] **Day 5**: タイトル画面
  - [ ] `src/components/screens/TitleScreen.tsx`
  - [ ] 新規ゲーム・ロード
  - [ ] 設定画面への遷移

- [ ] **Day 6-7**: 予備・調整

#### 成果物
- 全主要画面が実装完了

---

### Phase 9: AI連携（オプション） ⏱️ 3-4日

**Goal**: 振り返りレポート生成とAI判定

#### タスク一覧
- [ ] **Day 1**: FastAPI バックエンド
  - [ ] `backend/main.py`
  - [ ] `/api/v1/analyze` エンドポイント
  - [ ] CORS設定

- [ ] **Day 2**: AI分析サービス
  - [ ] `src/services/aiService.ts`
  - [ ] Gemini API / OpenAI API 統合
  - [ ] プロンプト生成

- [ ] **Day 3**: 振り返りレポート画面
  - [ ] `src/components/screens/ReportScreen.tsx`
  - [ ] マークダウン表示
  - [ ] PDF出力（オプション）

- [ ] **Day 4**: 直談判AI判定統合
  - [ ] カードバトルのAI判定
  - [ ] スコアリング・フィードバック

#### 成果物
- AI振り返りレポート生成成功
- 直談判カードでAI判定動作

---

### Phase 10: テスト・デバッグ・最適化 ⏱️ 5-7日

**Goal**: 品質保証とパフォーマンス改善

#### タスク一覧
- [ ] **Day 1-2**: ユニットテスト
  - [ ] ゲームエンジンのテスト
  - [ ] 計算ロジックのテスト
  - [ ] Vitest 使用

- [ ] **Day 3**: E2Eテスト
  - [ ] Playwright / Cypress
  - [ ] 主要フロー（新規ゲーム → ターン進行 → 完了）

- [ ] **Day 4-5**: バグ修正
  - [ ] 発見されたバグの修正
  - [ ] エッジケース対応

- [ ] **Day 6**: パフォーマンス最適化
  - [ ] React DevTools プロファイリング
  - [ ] 不要な再レンダリング削減
  - [ ] IndexedDB アクセス最適化

- [ ] **Day 7**: アクセシビリティ
  - [ ] WCAG 2.1 AA 準拠確認
  - [ ] キーボードナビゲーション
  - [ ] スクリーンリーダー対応

#### 成果物
- テストカバレッジ 70%以上
- パフォーマンススコア改善

---

### Phase 11: PWA化・デプロイ ⏱️ 2-3日

**Goal**: プログレッシブWebアプリ化と本番デプロイ

#### タスク一覧
- [ ] **Day 1**: PWA設定
  - [ ] Service Worker 設定
  - [ ] manifest.json
  - [ ] オフライン動作確認

- [ ] **Day 2**: ビルド最適化
  - [ ] Code Splitting
  - [ ] 画像最適化
  - [ ] Lighthouse スコア改善

- [ ] **Day 3**: デプロイ
  - [ ] GitHub Pages / Netlify / Vercel
  - [ ] CI/CD設定（GitHub Actions）
  - [ ] 本番環境確認

#### 成果物
- **本番環境でアプリが動作**
- PWAとしてインストール可能

---

## 📅 全体スケジュール概算

| フェーズ | 期間 | 累積日数 |
|---------|------|----------|
| Phase 0: セットアップ | 1日 | 1日 |
| Phase 1: データ基盤 | 3-4日 | 5日 |
| **Phase 1.5: 太閤立志伝要素基盤【新規】** | **5-7日** | **12日** |
| Phase 2: 状態管理・エンジン | 5-6日 | 18日 |
| Phase 3: UIコンポーネント | 7-8日 | 26日 |
| Phase 4: メイン画面 | 8-10日 | 36日 |
| Phase 5: ダッシュボード | 3-4日 | 40日 |
| Phase 6: カードバトル | 5-6日 | 46日 |
| Phase 7: セーブ/ロード | 2-3日 | 49日 |
| Phase 8: 追加画面 | 5-7日 | 56日 |
| **Phase 8.5: 太閤要素UI【新規】** | **5-7日** | **63日** |
| Phase 9: AI連携（オプション） | 3-4日 | 67日 |
| Phase 10: テスト・最適化 | 5-7日 | 74日 |
| Phase 11: PWA・デプロイ | 2-3日 | 77日 |

**総計**: 約 **2.5ヶ月（1人フルタイム換算）**

パートタイム作業の場合、4-5ヶ月を見込む。

---

## ✅ チェックリスト（MVP完成基準）

### 必須機能（MVP）
- [ ] ゲーム開始（新規・ロード）
- [ ] ダッシュボード表示
- [ ] PMコックピットでターン進行
- [ ] キャラクターアサイン（ドラッグ&ドロップ）
- [ ] EVM計算・表示
- [ ] カードバトル基本動作
- [ ] セーブ/ロード
- [ ] データエクスポート/インポート

### オプション機能
- [ ] AI振り返りレポート
- [ ] 休暇調整パズル
- [ ] 固有NPC の二つ名システム
- [ ] サウンド・BGM
- [ ] マルチ言語対応（英語）

---

## 🎯 成功の定義

1. **動作確認**: 新規ゲーム → 3プロジェクト完了 → セーブ/ロード → 正常動作
2. **学習効果**: プレイ後、PMBOK用語を5つ以上説明できる
3. **ユーザー体験**: 「もう1ターンだけ」と思わせる中毒性
4. **パフォーマンス**: ターン処理 500ms以内、Lighthouse スコア 90+

---

## 📝 開発ルール

### コーディング規約
- TypeScript strict mode 有効
- ESLint + Prettier 使用
- コミットメッセージ: Conventional Commits

### Git運用
- ブランチ戦略: GitHub Flow
- PR必須（セルフレビューでもOK）
- main ブランチは常にデプロイ可能状態

### ドキュメント
- コンポーネントに props 型定義必須
- 複雑なロジックにはコメント必須
- README.md 常に最新化

---

**次回作業開始時**: Phase 0 から順に実施してください。

**Good luck! 🚀**
