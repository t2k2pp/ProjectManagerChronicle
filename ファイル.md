# プロジェクト名：PM立志伝：プロジェクト・クロニクル

**Edition**: Local-First Architecture Ver 1.0

## 1. アーキテクチャ基本方針

本アプリケーションは、**「ローカルファースト（Local-First）」**思想に基づき設計される。

ゲームの全状態管理、ロジック計算、データ永続化はクライアント（ブラウザ）側で完結させ、サーバーは「AI機能の提供」のみを行うステートレスな構成とする。

### 1.1 技術スタック構成

- **Frontend & Logic**: React (Vite) + TypeScript
    
- **State Management**: React Context + Reducer (または Zustand)
    
- **Persistence (DB)**: IndexedDB (Wrapper: **Dexie.js**)
    
- **UI Framework**: Tailwind CSS + Framer Motion (アニメーション) + Recharts (グラフ描画)
    
- **Backend (AI Proxy)**: FastAPI (Python) ※AI機能利用時のみ通信
    

### 1.2 データ保全とセキュリティ

- **保存場所**: ユーザーのブラウザ内 (IndexedDB)。
    
- **データ消失対策**: JSON形式による「プロジェクトデータのエクスポート/インポート」機能を実装。
    
- **チート対策**: 行わない。クライアントサイドの改変は許容する（学習機会と捉える）。
    

## 2. データモデル設計 (Schema Definition)

IndexedDB (`Dexie.js`) に格納するスキーマ定義。リレーションはID参照で解決する。

### 2.1 Characters (社員データ)

`id` (UUID) を主キーとする。

|

| プロパティ | 型 | 説明 |

| id | string | UUID |

| name | string | 社員名 |

| age_group | string | 20s / 30-40s / 50s+ |

| job_class | string | エンジニア上がり / 営業上がり 等 |

| stats_blue | object | 表スキル（プロジェクト遂行） { design, develop, test, negotiation, idea, judgment } (各0-10) |

| stats_red | object | 裏スキル（チーム運営） { admin, organizer, service, chat, charm, luck } (各0-10) |

| stamina | object | { current: number, max: number, recovery_rate: number } |

| traits | array | 特性タグ

$$"vacation_lover", "night_owl", "awakened"$$

|

| hidden_data | object | 覚醒前のマスクデータ { true_name: string, true_stats: object } |

### 2.2 Projects (案件データ)

進行中のプロジェクト状態。

| プロパティ | 型 | 説明 |

| id | string | UUID |

| name | string | 案件名 |

| budget | object | { initial: number, current: number } |

| schedule | object | { start_week: number, end_week: number, current_week: number } |

| evm | object | { pv: number, ev: number, ac: number, spi: number, cpi: number } |

| status | string | PLANNING / RUNNING / COMPLETED / FAILED |

### 2.3 Tasks (WBSデータ)

ガントチャートを構成するタスク。

| プロパティ | 型 | 説明 |

| id | string | UUID |

| project_id | string | FK |

| assignee_id | string | FK (Character ID) |

| phase | string | REQUIREMENT / DESIGN / DEVELOP / TEST |

| progress | number | 0 - 100 (%) |

| quality | number | 品質スコア（低いとバグ発生） |

| risk_factor | number | 潜在リスク値（「判断」スキルでのみ可視化） |

### 2.4 WeeklyLogs (ログデータ)

AI分析用に記録する時系列データ。

| プロパティ | 型 | 説明 |

| week | number | 第N週 |

| event_type | string | PROGRESS / TROUBLE / DECISION |

| description | string | 「佐藤がバグを発見」「PMが納期延長を選択」 |

| pm_comment | string | プレイヤーの自由記述（任意） |

## 3. ゲームサイクルとロジック (Client-Side Logic)

1ターン（1週間）の処理フロー詳細。全ての計算はブラウザ上のJavaScriptで実行される。

### 3.1 フェーズ1：Monday Plan（アサインと方針）

- **入力**: プレイヤーによるドラッグ＆ドロップ（タスクへのキャラ割り当て）。
    
- **方針選択**:
    
    - `Normal`: 補正なし
        
    - `Quality First`: 進行0.8倍 / 品質1.2倍
        
    - `Rush`: 進行1.5倍 / 品質0.7倍 / スタミナ消費1.5倍
        
- **計算**: 変更即時反映（Optimistic UI）。SPI/CPIの予測値をリアルタイム表示。
    

### 3.2 フェーズ2：Execute Week（シミュレーション実行）

「実行」ボタン押下後、火～金曜の4ステップをループ処理する。

1. **日次進捗計算**:
    
    - `進捗 = (キャラの製造スキル + 覚醒補正 + 美貌ボーナス) * 方針補正`
        
    - `スタミナ消費 = 基礎値 - (給仕スキル補正)`
        
2. **イベント判定（確率発動）**:
    
    - **トラブル**: `(100 - 品質スコア)%` の確率でバグ発生 → 進捗巻き戻し。
        
    - **ラッキー**: `幸運スキル` 値に基づく確率でトラブル無効化。
        
    - **判断/直感**: トラブル発生時、スキルが高いキャラがいれば自動解決（Auto-Resolve）し、ログのみ出力。
        
3. **カットイン処理**:
    
    - 重大なトラブル（判断必須）の場合、ループを一時停止し、モーダルダイアログを表示。
        
    - プレイヤーの選択結果をステータスに反映し、ループ再開。
        

### 3.3 フェーズ3：Friday Review（週次更新）

- **EVM確定**: その週のPV, EV, ACを確定し、履歴配列にpush。
    
- **コンディション更新**:
    
    - `現在のAP + (回復力 + 幹事スキル補正)` を計算。
        
    - 回復しきれない場合、最大AP減少デバフを適用（蓄積疲労）。
        
- **オートセーブ**: Dexie.jsに対し、更新された全オブジェクトを`put`。
    

## 4. 画面・UI仕様 (Detailed View)

### 4.1 メイン画面：PMコックピット

単一画面内に情報を集約し、コックピットのような操作感を提供する。

- **Header (HUD)**:
    
    - **カレンダー**: `yyyy年m月 第w週` 表示。季節アイコン（桜、太陽、紅葉、雪）。
        
    - **EVMメーター**: 針式メーターコンポーネント。`SPI > 1.0` (緑), `SPI < 1.0` (赤)。
        
- **Main Left (Office View)**:
    
    - グリッド配置された座席表。
        
    - キャラカード：顔アイコン、名前、HPバー、状態アイコン（！、Zzz...）。
        
    - クリックで「詳細ステータス（ダブル・ヘキサゴン）」モーダル展開。
        
- **Main Right (Gantt Chart)**:
    
    - Recharts または カスタムSVGによる描画。
        
    - タスクバーへのドラッグ＆ドロップ（`dnd-kit`推奨）でアサイン変更。
        
    - 「直感」スキル保有時、特定タスクに`RiskIcon`（ドクロ）をオーバーレイ表示。
        
- **Footer (Command Deck)**:
    
    - `EXECUTE` ボタン（ターン進行）。
        
    - `EXPORT/IMPORT` ボタン（JSONファイル操作）。
        

### 4.2 特殊画面：休暇調整パズル

GW、お盆、正月の2週間前にモーダル表示。

- **表示**: カレンダーグリッドに各メンバーの「希望休」がブロックとして置かれている。
    
- **操作**: 休日ブロックをクリックして交渉。
    
- **ロジック**:
    
    - 対象が`Trait: VacationLover` → 交渉不可（ロック）。
        
    - 対象が`Trait: MoneyLover` → 予算消費でブロック解除。
        
    - 対象が`Trait: Standard` → AP消費（説得）でブロック解除。
        

## 5. 外部連携仕様 (Import/Export)

サーバーレス構成のため、ファイルベースのデータ管理を実装する。

### 5.1 エクスポート形式 (JSON)

```
{
  "version": "1.0",
  "exported_at": "2025-12-30T12:00:00Z",
  "save_data": {
    "company_info": { ... },
    "characters": [ ... ],
    "current_project": { ... },
    "tasks": [ ... ],
    "logs": [ ... ]
  },
  "checksum": "sha256_hash_string" // 簡易的な破損チェック用（改変防止ではない）
}

```

### 5.2 AI分析リクエスト (Backend通信)

ゲームクリア時のみ、FastAPIへログを送信する。

- **Endpoint**: `POST /api/v1/analyze`
    
- **Payload**: `WeeklyLogs` 配列と、最終スコア。
    
- **Response**: Markdown形式のテキスト（PMタイプ診断、KPT、用語解説）。
    

## 6. 開発ロードマップ (MVP)

1. **Phase 1: コアエンジンの実装**
    
    - Reactプロジェクト作成 (Vite)。
        
    - Dexie.js スキーマ定義。
        
    - 「アサイン → ターン進行 → 計算」のループ論理実装（UIはテキストのみ）。
        
2. **Phase 2: UI構築**
    
    - PMコックピット画面の実装。
        
    - ダブル・ヘキサゴン、EVMメーターの描画。
        
3. **Phase 3: イベント・特性の実装**
    
    - トラブルイベント、カットイン演出。
        
    - 休暇調整パズルの実装。
        
4. **Phase 4: AI連携・調整**
    
    - インポート/エクスポート機能。
        
    - FastAPIモック作成と接続。